<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Chat Room</title>
</head>
<body>
  <h1>Chat Room: {{ room_id }}</h1>
  <div id="messages"></div>
  <input type="text" id="messageInput" placeholder="Type a message..." />
  <button onclick="sendMessage()">Send</button>

  <script>
    // We'll use the 'room_id' passed in from the view/context
    const roomId = "{{ room_id }}";

    // Build the WebSocket URL (adjust if using HTTPS or a different port)
    const wsUrl = `ws://${window.location.host}/ws/chat/${roomId}/`;

    const chatSocket = new WebSocket(wsUrl);

    chatSocket.onopen = function(e) {
      console.log("WebSocket connection opened!");
    };

    chatSocket.onmessage = function(e) {
      const data = JSON.parse(e.data);
      const messagesDiv = document.getElementById('messages');
      const newMessage = document.createElement('div');
      newMessage.textContent = `User ${data.sender_id || 'Anonymous'}: ${data.message}`;
      messagesDiv.appendChild(newMessage);
    };

    chatSocket.onerror = function(error) {
      console.error("WebSocket error:", error);
    };

    chatSocket.onclose = function(e) {
      console.log("WebSocket connection closed.");
    };

    function sendMessage() {
      const input = document.getElementById('messageInput');
      const message = input.value;
      chatSocket.send(JSON.stringify({ message: message }));
      input.value = '';
    }
  </script>
</body>
</html>
